<section>
  <table class="header">
    <tr>
      <th class="small">Действие</th>
      <th class="medium">Инициатор</th>
      <th class="medium">Контрагент</th>
      <th class="large">Наименование</th>
      <th class="small">Номер</th>
      <th class="small">Дата</th>
      <th class="small">Сумма</th>
      <th class="medium">Отметка</th>
      <th class="small">Статус</th>
      <th class="small">Дата копии</th>
      <th class="small">Дата ориг-ла</th>
      <th class="medium">Комментарий</th>
    </tr>
    <tr>
      <th class="small"><button>Добавить</button></th>
      <th class="medium"><input type="text" /></th>
      <th class="medium"><input type="text" /></th>
      <th class="large"><input type="text" /></th>
      <th class="small"><input type="text" /></th>
      <th class="small"><input type="text" /></th>
      <th class="small"><input type="text" /></th>
      <th class="medium"></th>
      <th class="small"></th>
      <th class="small"><input type="text" /></th>
      <th class="small"><input type="text" /></th>
      <th class="medium"><input type="text" /></th>
    </tr>
  </table>
  <!-- <table class="content"> -->
  <!-- <tr *ngFor="let row of table">
            <td class="medium">{{row.contractor.name}}</td>
            <td class="large">{{row.destination}}</td>
            <td class="medium">{{row.initiator ? row.initiator.name : ""}}</td>
            <td class="small">{{row.sum}}</td>
            <td class="small">{{row.sumClosing}}</td>
            <td class="small">В работе</td>
            <td class="medium">{{row.about ? row.about.text : ""}}</td>
            <td class="medium">{{row.mark ? row.mark.text : ""}}</td>
            <td class="small">{{row.status ? row.status.text : ""}}</td>
            <td class="small">{{row.copyDate}}</td>
            <td class="small">{{row.origDate}}</td>
            <td class="medium">{{row.title}}</td>
        </tr> -->
  <!-- </table> -->
  <ng-container *ngIf="table.length !== 0; else loading">
    <table class="content">
      <tr
        *ngFor="let row of table"
        (click)="toggleSelected(row)"
        [class.selected]="row === selectedRow"
      >
        <td class="medium">{{ row.contractor.name }}</td>
        <td class="large">{{ row.destination }}</td>
        <td class="medium">{{ row.initiator ? row.initiator.name : "" }}</td>
        <td class="small">{{ row.sum }}</td>
        <td class="small">
          <input
            type="number"
            (change)="onChange(row, 'sumClosing')"
            [(ngModel)]="row.sumClosing"
            [ngClass]="{ changed: row.isChanged_sumClosing }"
            min="0"
            step="1000"
          />
        </td>
        <td class="small">{{ dd.control[control(row)].text }}</td>
        <td class="small">
          <select
            [ngClass]="{ changed: row.isChanged_about }"
            (change)="onChange(row, 'about', $event.target)"
          >
            <option
              *ngFor="let d of dd.about"
              [value]="d.id"
              [selected]="d.id === row.about.id"
            >
              {{ d.text }}
            </option>
          </select>
        </td>
        <td class="small">
          <ng-container *ngIf="allow(); else notAllow">
            <select
              [ngClass]="{ changed: row.isChanged_mark }"
              (change)="onChange(row, 'mark', $event.target)"
            >
              <option
                *ngFor="let d of dd.mark"
                [value]="d.id"
                [selected]="d.id === row.mark.id"
              >
                {{ d.text }}
              </option>
            </select>
          </ng-container>
          <ng-template #notAllow>{{ row.mark.text }}</ng-template>
        </td>
        <td class="small">
          <select
            [ngClass]="{ changed: row.isChanged_status }"
            (change)="onChange(row, 'status', $event.target)"
          >
            <option
              *ngFor="let d of dd.status"
              [value]="d.id"
              [selected]="d.id === row.status.id"
            >
              {{ d.text }}
            </option>
          </select>
        </td>
        <td class="small">
          <input
            type="date"
            (change)="onChange(row, 'copyDate')"
            [(ngModel)]="row.copyDate_string"
            [ngClass]="{ changed: row.isChanged_copyDate }"
            [attr.readonly]="!allow() ? true : null"
          />
        </td>
        <td class="small">
          <input
            type="date"
            (change)="onChange(row, 'origDate')"
            [(ngModel)]="row.origDate_string"
            [ngClass]="{ changed: row.isChanged_origDate }"
            [attr.readonly]="!allow() ? true : null"
          />
        </td>
        <td class="medium">
          <input
            type="text"
            (change)="onChange(row, 'title')"
            [(ngModel)]="row.title"
            [ngClass]="{ changed: row.isChanged_title }"
          />
        </td>
      </tr>
    </table>
  </ng-container>
  <ng-template #loading>
    <div class="loading"><img [src]="loadingPage" /></div>
  </ng-template>
</section>
